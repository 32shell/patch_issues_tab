From 690911aea286f6c97887e1db81633471d4787729 Mon Sep 17 00:00:00 2001
From: Marius BALTEANU <marius.balteanu@zitec.com>
Date: Sun, 9 Sep 2018 11:05:02 +0000
Subject: [PATCH 1/8] allow tabs to have a custom action

---
 app/helpers/application_helper.rb | 11 +++++++++++
 app/views/common/_tabs.html.erb   |  8 +++++++-
 2 files changed, 18 insertions(+), 1 deletion(-)

diff --git app/helpers/application_helper.rb b/app/helpers/application_helper.rb
index 6b4ac30..4067f33 100644
--- app/helpers/application_helper.rb
+++ b/app/helpers/application_helper.rb
@@ -407,6 +407,17 @@ module ApplicationHelper
     end
   end
 
+  # Returns the tab action depending on the tab properties
+  def get_tab_action(tab)
+    if tab[:onclick]
+      return tab[:onclick]
+    elsif tab[:partial]
+      return "showTab('#{tab[:name]}', this.href)"
+    else
+      return nil
+    end
+  end
+
   # Returns the default scope for the quick search form
   # Could be 'all', 'my_projects', 'subprojects' or nil (current project)
   def default_search_project_scope
diff --git app/views/common/_tabs.html.erb b/app/views/common/_tabs.html.erb
index 1b880c9..df7513e 100644
--- app/views/common/_tabs.html.erb
+++ b/app/views/common/_tabs.html.erb
@@ -1,10 +1,14 @@
+<% default_action = false %>
+
 <div class="tabs">
   <ul>
   <% tabs.each do |tab| -%>
+    <% action = get_tab_action(tab) %>
     <li><%= link_to l(tab[:label]), (tab[:url] || { :tab => tab[:name] }),
                                     :id => "tab-#{tab[:name]}",
                                     :class => (tab[:name] != selected_tab ? nil : 'selected'),
-                                    :onclick => tab[:partial] ? "showTab('#{tab[:name]}', this.href); this.blur(); return false;" : nil %></li>
+                                    :onclick => (action.nil? ? nil : "#{ action }; return false;") %></li>
+    <% default_action = action if tab[:name] == selected_tab %>
   <% end -%>
   </ul>
   <div class="tabs-buttons" style="display:none;">
@@ -19,3 +23,5 @@
                        :style => (tab[:name] != selected_tab ? 'display:none' : nil),
                        :class => 'tab-content') if tab[:partial] %>
 <% end -%>
+
+<%= javascript_tag default_action if default_action %>
-- 
2.1.4

